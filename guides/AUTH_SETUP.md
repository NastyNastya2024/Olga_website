# Настройка авторизации

Авторизация в админ-панели **включена** и работает с проверкой логина и пароля.

## Учетные данные

**Email:** `admin@example.com`  
**Пароль:** `admin123`

## Как войти в админку

1. На любой публичной странице нажмите кнопку **"Вход"** в header
2. Введите email и пароль
3. Нажмите **"Войти"**
4. После успешной авторизации вы попадете в админ-панель

## Защита маршрутов

### Страницы, доступные всем авторизованным пользователям:
- ✅ **Видео** - просмотр и управление видео
- ✅ **Ученики** - просмотр и управление пользователями

### Страницы, доступные только администраторам:
- ✅ **Туры** - управление турами
- ✅ **Блог** - управление статьями
- ✅ **Клуб** - управление ценами и отзывами

### Страница логина:
- Доступна только неавторизованным пользователям
- Если вы уже авторизованы, будет автоматический редирект на страницу "Видео"

## Выход из системы

Нажмите кнопку **"Выйти"** в правом верхнем углу админ-панели.

## Технические детали

### Backend:
- Роут авторизации: `POST /api/admin/auth/login`
- Используется JWT токены для авторизации
- Пароли хранятся в захешированном виде (bcrypt)
- Middleware для проверки токенов: `backend/middleware/auth.js`

### Frontend:
- Guards для проверки доступа: `admin/scripts/guards.js`
- Функции авторизации: `shared/scripts/auth.js`
- Токен хранится в `localStorage` под ключом `auth_token`

### Файлы данных:
- Пользователи хранятся в `data/users.json`
- Пароли автоматически хешируются при первом входе (если были в открытом виде)

## Установка зависимостей

Перед использованием авторизации убедитесь, что установлены все зависимости:

```bash
cd backend
npm install
```

Необходимые пакеты:
- `jsonwebtoken` - для генерации и проверки JWT токенов
- `bcryptjs` - для хеширования паролей

## Изменение пароля

Для изменения пароля администратора:

1. Сгенерируйте новый хэш пароля:
```bash
node scripts/generate-password-hash.js ваш_новый_пароль
```

2. Обновите файл `data/users.json`:
```json
{
  "items": [
    {
      "id": 1,
      "email": "admin@example.com",
      "password": "НОВЫЙ_ХЭШ_ПАРОЛЯ",
      ...
    }
  ]
}
```

## Создание нового пользователя

Добавьте пользователя в `data/users.json`:

```json
{
  "id": 2,
  "email": "user@example.com",
  "name": "User Name",
  "password": "$2a$10$...", // хэш пароля
  "role": "student", // или "admin"
  "status": "active",
  ...
}
```

Для генерации хэша пароля используйте:
```bash
node scripts/generate-password-hash.js пароль_пользователя
```

## Переменные окружения

Для production окружения рекомендуется установить свой `JWT_SECRET`:

Создайте файл `backend/.env`:
```env
JWT_SECRET=your-very-secret-key-change-in-production
JWT_EXPIRES_IN=24h
```

См. также:
- [CREDENTIALS.md](./CREDENTIALS.md) - Учетные данные по умолчанию
- [NO_AUTH.md](./NO_AUTH.md) - Информация об отключенной авторизации (устарело)
